import fs from "fs";
import {ManifestPath, VersionSuffixArgMarker} from "./Config.js";

function getVersionSuffix(){
    const versionSuffixMarker = process.argv.find(u => u == VersionSuffixArgMarker);
    const versionSuffixIndex = process.argv.indexOf(versionSuffixMarker) + 1;
    return process.argv[versionSuffixIndex];
}

function setVersionSuffix(){
    const suffix = getVersionSuffix();
    const rawManifest = fs.readFileSync(ManifestPath);
    const manifest = JSON.parse(rawManifest.toString().trim());
    const rawVersion = manifest.version.split("-");

    if (suffix.includes("release")){
        manifest.version = rawVersion[0];
    }
    else if (rawVersion.length > 1){
        manifest.version = rawVersion[0] + "-" + suffix;
    }else{
        manifest.version = manifest.version + "-" + suffix;
    }

    console.log(manifest.version);
    fs.writeFileSync(ManifestPath, JSON.stringify(manifest, null, 3));
}

setVersionSuffix();